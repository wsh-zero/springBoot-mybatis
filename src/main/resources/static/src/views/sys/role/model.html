<div class="layui-form" lay-filter="role-model-filter">
    <input type="hidden" name="id" class="layui-input">
    <div class="layui-form-item">
        <label class="layui-form-label required">角色名称</label>
        <div class="layui-input-block">
            <input type="text" name="roleName" lay-verify="required" placeholder="角色名称"
                   class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">权限选择</label>
        <div class="layui-input-block">
            <br/>
            <ul id="powetZtree" class="ztree"></ul>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label"></label>
        <div class="layui-input-inline">
            <input type="button" lay-submit lay-filter="role-submit-filter" value="确认" class="layui-btn">
        </div>
    </div>
</div>
<!--根目录不能操作-->
<style type="text/css">
    .ztree li span.button.switch.level0 {
        visibility: hidden;
        width: 1px;
    }

    .ztree li ul.level0 {
        padding: 0;
        background: none;
    }

    .ztree * {
        padding: 0;
        margin: 0;
        font-size: 12px;
        font-family: Verdana, Arial, Helvetica, AppleGothic, sans-serif
    }

    .ztree li {
        padding: 0;
        margin: 0;
        list-style: none;
        line-height: 17px;
        text-align: left;
        white-space: nowrap;
        outline: 0
    }

    .ztree li span.button {
        height: 17px;
    }

    .ztree li a.curSelectedNode {
        padding-top: 0px;
        background-color: transparent;
        color: black;
        height: 21px;
        opacity: 0.8;
    }
</style>
<script>
    layui.use(['admin', 'table', 'form'], function () {
        var admin = layui.admin;

        var setting = {
            async: {
                enable: true,
                autoParam: ["id"]
            },
            data: {
                simpleData: {
                    enable: true,
                    idKey: "id",
                    pIdKey: "parent",
                    rootPId: 0
                }
            },
            check: {
                enable: true//checkbox
            },
            view: {
                showIcon: showIcon,
                nameIsHTML: true, //允许name支持html
                selectedMulti: false
                // , fontCss: {'color': 'blue', 'font-family': '微软雅黑'}
                , dblClickExpand: dblClickExpand
            },
            edit: {
                enable: false,
                editNameSelectAll: false
            },
            callback: {
                onClick: onClick//点击事件
            }
        };

        function onClick(event, treeId, treeNode, clickFlag) {
            if (treeNode.level > 0) {
                //实现单击展开
                var treeObj = getTreeObj();
                treeObj.expandNode(treeNode);
            }
        }

        //取消双击展开功能
        function dblClickExpand(treeId, treeNode) {
            return false;
        }

        //设置图标
        function showIcon(treeId, treeNode) {
            return true;
        }

        //获取树对象
        function getTreeObj() {
            return $.fn.zTree.getZTreeObj("powetZtree");
        }

        admin.req({
            url: "/sys/power/get/powers"
            , type: 'get'
            , success: function (res) {
                res.data[0].open = true
                res.data[0].iconClose = "/zTree_v3/img/1_open.png"
                res.data[0].iconOpen = "/zTree_v3/img/1_open.png"
                $.fn.zTree.init($("#powetZtree"), setting, res.data);
            }
        });
    });

</script>
