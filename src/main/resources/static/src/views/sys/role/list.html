<title>菜单分配</title>
<div class="layui-fluid">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-sm4">
            <div class="layui-card zero-height-brace-up" style="width: 25%">
                <div class="layui-card-header">用户留言</div>
                <div class="layui-card-body ">
                    <input type="text" id="key" placeholder="检索权限" class="layui-input" title="检索权限">
                    <div id="navTree">
                        <ul id="tree" class="ztree"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-sm8">
            <div class="layui-card zero-height-brace-up" style="width: 54%">
                <div class="layui-card-header">用户留言</div>
                <div class="layui-card-body">
                </div>
            </div>
        </div>
    </div>
</div>
<!--根目录不能操作-->
<style type="text/css">
    .ztree li span.button.switch.level0 {
        visibility: hidden;
        width: 1px;
    }

    .ztree li ul.level0 {
        padding: 0;
        background: none;
    }
</style>
<script>
    layui.use(['admin', 'table'], function () {
        var admin = layui.admin;

        var setting = {
            async: {
                enable: true,
                autoParam: ["id"]
            },
            data: {
                simpleData: {
                    enable: true,
                    idKey: "id",
                    pIdKey: "parent",
                    rootPId: 0
                }
            },
            check: {
                // enable: true//checkbox
            },
            view: {
                showIcon: showIcon,
                nameIsHTML: true, //允许name支持html
                selectedMulti: false
                // , fontCss: {'color': 'blue', 'font-family': '微软雅黑'}
                , dblClickExpand: dblClickExpand
            },
            edit: {
                enable: false,
                editNameSelectAll: false
            },
            callback: {
                onClick: onClick//点击事件
            }
        };

        function onClick(event, treeId, treeNode, clickFlag) {
            if (treeNode.level > 0) {
                //实现单击展开
                var zTree = $.fn.zTree.getZTreeObj("tree");
                zTree.expandNode(treeNode);
            }
        }

        function dblClickExpand(treeId, treeNode) {
            return treeNode.level > 0;
        }
        function showIcon(treeId, treeNode) {
            return treeNode.level === 0;
        }

        admin.req({
            url: "/sys/menu/get_tree"
            , success: function (res) {
                res.data[0].open=true
                res.data[0].iconClose="/zTree_v3/img/1_open.png"
                res.data[0].iconOpen="/zTree_v3/img/1_open.png"
                console.log(res.data[0])
                $.fn.zTree.init($("#tree"), setting, res.data);
                fuzzySearch('tree', '#key', null, true); //初始化模糊搜索方法
            }
        });

    });

</script>